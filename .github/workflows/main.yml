name: Build Sovereign V41

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  build:
    runs-on: macos-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    
    # إزالة setup-xcode واستخدام الافتراضي
    - name: Verify Xcode Version
      run: |
        xcodebuild -version
        xcode-select -p
        
    - name: Install Theos
      run: |
        git clone --recursive https://github.com/theos/theos.git ~/theos
        echo "THEOS=~/theos" >> $GITHUB_ENV
        
    - name: Install Dependencies
      run: |
        brew install ldid dpkg make clang
        # تثبيت Ruby gems إذا لزم الأمر
        sudo gem install concurrent-ruby -v 1.2.2
        
    - name: Build
      run: |
        export THEOS=~/theos
        export THEOS_MAKE_PATH=$THEOS/makefiles
        
        # إذا كان هناك دليل محدد للمشروع
        if [ -d "SovereignV41" ]; then
          cd SovereignV41
        fi
        
        # تنظيف وبناء
        make clean 2>/dev/null || true
        make package
        
    - name: Upload Artifacts
      uses: actions/upload-artifact@v4
      with:
        name: Build-Output
        path: |
          *.deb
          packages/
          .theos/_/Payload/
